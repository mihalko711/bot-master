(window.__LOADABLE_LOADED_CHUNKS__=window.__LOADABLE_LOADED_CHUNKS__||[]).push([["pharmacy-actions"],{39:function(a,e,r){"use strict";var t=r(8),n=r(27),o=r(18),c=r(723),i=r(56),s=r(64);var u=r(735),d=r(29);r(42);var p=r(0),l=(r(44),["mastercardStandart","goldMastercard","worldMastercard","platinumMastercard","worldMastercardBlackEdition","worldEliteMastercard"]),h=["mastercardBusinessCard","mastercardWorldBusinessCard","mastercardPreferredBusinessCard","mastercardCorporateCard"],m=[].concat(l,h);var y={anyCard:"",mastercardStandart:"mastercard_standard",goldMastercard:"gold_mastercard",worldMastercard:"world_mastercard",platinumMastercard:"platinum_mastercard",worldMastercardBlackEdition:"worldblack_mastercard",worldEliteMastercard:"worldelite_mastercard",mastercardBusinessCard:"business_mastercard",mastercardWorldBusinessCard:"worldbusiness_mastercard",mastercardPreferredBusinessCard:"preferredbusiness_mastercard",mastercardCorporateCard:"corporate_mastercard"};function f(a,e){var r;if(void 0===e&&(r=p.a.get("promo_mastercard_type"),e=Array.isArray(r)?r.filter(function(a){return m.includes(a)}):[]),!a.includes("provider:mastercardoffers"))return a;var t=a.replace(/\(? ?feature:\(mastercards_types.*?\)( \|)?\)?/,"");return 0===e.length?t:t+"("+e.map(function(a){return"feature:(mastercards_types:"+y[a]+")"}).join(" | ")+")"}var g="search_",E="",v={fetch:function(a,e){return Object(d.a)("search",{query:_(a,e)},e).then(function(a){return E=a.requestId,a})},prepareChainSearchRequest:function(a,e){return v.fetch({count:1,kind:"locality",text:Object(c.a)(a.center,{reverse:!0}),origin:"chain-city"},e).then(function(e){var r={searchType:"TEXT",displayText:a.chain.name,text:"chain_id:("+a.chain.id+")",origin:a.origin||"chain"},t=e.bounds;if(t){var n=function(a){var e=a[0][1],r=[a[1][0]-a[0][0],a[1][1]-e],t=Math.tan(Object(i.a)(e+90)/2),n=Math.tan(Object(i.a)(r[1])/2),o=Math.max((-t*t-t*n)/(t*n-1),0),c=.5*Math.log(o),u=2*(Math.atan(Math.exp(c))-.25*Math.PI);return{center:[(a[0][0]+a[1][0])/2,Object(s.a)(u)],span:r}}(t);r.center=n.center,r.span=n.span}return r})},loadPoiByCoordinates:function(a,e){return v.fetch({text:Object(c.a)(a,{reverse:!0}),count:1,origin:"poi",snippets:e.search.snippets},e)},loadPoiByUri:function(a,e){return v.fetch({mode:"uri",uri:a,count:1,origin:"poi",snippets:e.search.snippets},e)},loadWhatshere:function(a,e){var r=a.origin,t=Object(n.a)(a,["origin"]);return v.fetch({pin:!0,text:Object(c.a)(t.coordinates,{reverse:!0}),zoom:t.zoom,span:[.001,.001],count:1,origin:r||"poi",addBuildingGeometry:a.addGeometry},e).then(function(a){var e=a.items[0];return e?("poi"===r&&(e.displayCoordinates=e.coordinates),a):null}).catch(function(){return null})}};function _(a,e){var r,n,i,s=a.clientId||"maps",d=a.origin?s+"-"+a.origin:s,p=((r={text:a.text,lang:e.locale,yandex_gid:e.userRegion.id,client_id:a.clientId,origin:d,results:a.count,ctx:a.context,mode:a.mode,lr:a.lr,uri:a.uri,business_oid:a.id,z:a.zoom,sort:a.sort,business_filter:a.filters,autoscale:a.autoscale,distinguish_layers:a.distinguishLayers,correct_misspell:a.correctMisspell,geocoder_kind:a.kind,skip:a.skip,rspn:a.restrictSpan,rearr:a.rearr,groupchains_advert:a.groupchains_advert,relev_ranking_formula:a.relev_ranking_formula,maxadv:a.maxadv})[o.a]=a[o.a],r.eventsBranch=e.query.eventsBranch,r);return(null===(n=e.pharmacy)||void 0===n?void 0:n.experiments.ui.noCheapZdravcity)&&(p[o.l]=!0),a.addBuildingGeometry&&(p.search_geometry="2"),a.sortOrigin&&(p.sort_origin=a.sortOrigin.join()),a.center&&(p.ll=a.center.join()),a.span&&(p.spn=a.span.join()),a.bbox&&(p.bbox=a.bbox.join("~")),a.snippets?p.snippets=a.snippets.join():p.snippets=e.search.snippets.join(),a.direct&&(p=Object(t.a)(Object(t.a)({},p),e.advert.direct.params)),a.pin&&(p.geocoder_pin=1),a.type&&(p.type=a.type.join()),a.routeCoordinates&&a.bounds&&a.routeCoordinates.some(function(e){return Object(u.a)(a.bounds,e)})&&(p.business_rll=a.routeCoordinates.map(function(a){return Object(c.a)(a,{fractionDigits:5})}).join("~")),a.clientUsecase&&(p.client_usecase=a.clientUsecase),a.suggestReqid&&"form"===a.origin&&(p.suggest_reqid=a.suggestReqid),a.serpId&&(p.serpid=a.serpId),(a.parentReqId||E||e.searchPreloadedResults)&&(p.parent_reqid=a.parentReqId||E||e.searchPreloadedResults.requestId),(e.experiments.ui.whatshereInDistrictTop||e.experiments.ui.whatshereInDistrictBottom)&&(p.includeWhatshereInDistrict=1),"map"===e.query.pharmacy&&(null===(i=e.pharmacy)||void 0===i?void 0:i.experiments.ui.morePins)&&(p.pharmacy="map",p.snippets="matchedobjects/1.x"),p.text=p.text&&f(p.text),Object(t.a)(Object(t.a)(Object(t.a)({},p),a.rawParams),function(a){var e=Object(t.a)({},a.experiments.geoSearchParams||{}),r=a.experiments.boxes;r&&(e["test-buckets"]=r);return Object.keys(a.query).forEach(function(r){r.startsWith(g)&&(e[r]=a.query[r])}),e}(e))}e.a=v},673:function(a,e,r){"use strict";r.r(e);var t,n,o,c,i,s,u=r(8),d=r(126),p=r(23),l=r(58),h=r(57),m=r(71),y=r(121),f=r(14),g=r(39),E=r(18),v=r(34),_=r(162),D=r(31),b=r(32),P=r(22),w=r(70),C=r(36),j=r(159),T=r(90),I=r(100),O={stopSearchLoading:function(){return function(a){a({type:"DEEP_EXTEND",payload:{pharmacy:{search:{isLoading:!1}}}})}},search:function(a,e){return function(r,n,o){var c,i=o.config,s=n();if(a=a||s.pharmacy.search.query){P.a.cancel(t),r({type:"DEEP_EXTEND",payload:{pharmacy:{search:{query:a,isLoading:!0}}}});var d=D.c({text:a},"/search",i);_.a("replace",{},d);var l=(null===(c=i.pharmacy)||void 0===c?void 0:c.geoId)||E.f,h=s.pharmacy.widget?Object(C.a)(s.pharmacy.widget.businessId):void 0;t=P.a.create(w.a.searchDrugs(Object(u.a)({query:a,geoId:l,uri:h},e),i),{success:function(a){var e;r({type:"DEEP_EXTEND",payload:{pharmacy:{pageType:"search",productPage:void 0,search:a}}}),1!==(null===(e=a.items)||void 0===e?void 0:e.length)||s.pharmacy.widget?r(O.stopSearchLoading()):(p.a.reachGoal("search_use",{query:a.query,originalQuery:a.originalQuery,itemCount:a.items.length}),r(O.fetchProduct(String(a.items[0].id))))},fail:function(a){Object(v.b)(a,{config:i,prefix:"[Search]"})}})}}},fetchProduct:function(a){return function(e,r,t){var o=t.config;P.a.cancel(n),n=P.a.create(w.a.fetchProduct(a,o),{success:function(r){if(r){var t=y.d(r,o),n=D.c({},"/product/"+a,o);_.a("replace",{},n),e({type:"DEEP_EXTEND",payload:{pharmacy:{pageType:"product",productPage:t,search:{query:""}}}});var c=t.product,i=t.selectedManufacturerName,s=t.selectedVariantId,u={sets:[{ids:y.f(c,i,s).drugIds.map(f.c)||[],count:1}]};e(h.a.reloadMap(u))}},fail:function(a){Object(v.b)(a,{config:o,prefix:"[Fetch Product]"})},always:function(){e(O.stopSearchLoading())}})}},updateSearchQuery:function(a,e){return function(r,t,n){var o=n.config,c=t();if(!c.pharmacy.search.isLoading){if("clear"===(null==e?void 0:e.reason)&&Boolean(c.pharmacy.search.query)){var i=D.c(o);_.a("replace",{},i),r({type:"DEEP_EXTEND",payload:{pharmacy:{search:{items:void 0}}}}),c.pharmacy.showcase.sections||r(O.fetchShowcase()),r(O.resetProduct())}return r({type:"DEEP_EXTEND",payload:{pharmacy:{search:{query:a}}}})}}},detachCartStorage:function(a){return function(e,r){e({type:"DEEP_EXTEND",payload:{pharmacy:{cart:a||r().pharmacy.cart,isCartDetached:!0}}})}},attachCartStorage:function(){return function(a){a({type:"DEEP_EXTEND",payload:{pharmacy:{cart:b.h(),isCartDetached:!1}}})}},detachDrugStore:function(){return function(a){a({type:"DEEP_EXTEND",payload:{pharmacy:{selectedDrugStore:void 0}}})}},openCheckout:function(a){return function(e,r){var t=r();e({type:"DEEP_EXTEND",payload:{pharmacy:{selectedDrugStore:a||t.pharmacy.selectedDrugStore}}}),e(O.updatePharmacyDialog("store_chosen"))}},updatePharmacyDialog:function(a){return function(e,r){var t=r(),n=a?Object(u.a)(Object(u.a)({},t.pharmacy.dialog),{},{step:a}):{step:null,type:void 0};e(a?I.a.push({mode:"checkout",step:a}):I.a.close()),null===a&&"map"!==t.config.query.pharmacy&&e(O.attachCartStorage()),null===a&&e(O.detachDrugStore());var o="ready"===a?{cart:b.c({isDryRun:t.pharmacy.isCartDetached})}:{};return e({type:"DEEP_EXTEND",payload:{pharmacy:Object(u.a)(Object(u.a)({},o),{},{dialog:n})}})}},updateCartItemQuantity:function(a,e){return function(r,t){var n=t(),o=[].concat(a).map(f.c),c=n.pharmacy.cart.sets.find(function(a){var e=a.ids;return f.B(e,o)});c&&(c.count>e?p.a.reachGoal("cart_remove_drug"):p.a.reachGoal("cart_add_drug")),r({type:"DEEP_EXTEND",payload:{pharmacy:{cart:b.u(a,e,n.pharmacy.isCartDetached,n.pharmacy.cart)}}});var i=t();i.pharmacy.cartCheckoutPage&&r({type:"DEEP_EXTEND",payload:{pharmacy:{cartCheckoutPage:{cartCheckoutItems:b.s(i.pharmacy.cartCheckoutPage.cartCheckoutItems,i.pharmacy.cart)}}}})}},updateCartItemIds:function(a,e){return function(r,t){var n=t();r({type:"DEEP_EXTEND",payload:{pharmacy:{cart:b.t(a,e,n.pharmacy.isCartDetached,n.pharmacy.cart)}}})}},openShowcaseCart:function(){return{type:"DEEP_EXTEND",payload:{pharmacy:{isCartOpen:!0}}}},closeShowcaseCart:function(){return{type:"DEEP_EXTEND",payload:{pharmacy:{isCartOpen:!1}}}},openCart:function(){return function(a,e,r){var t,n,o,c,i=r.config,s=e();if(p.a.reachGoal("cart_click"),null!==(t=i.pharmacy)&&void 0!==t&&t.experiments.ui.newCart)window.open(D.c({},"/cart",i),"_self");else{if(!s.pharmacy.selectedDrugStore&&!s.pharmacy.widget||0===s.pharmacy.cart.sets.length)return a(O.updatePharmacyDialog("store_choosing"));var u=((c={type:["biz"],count:1,id:(null===(n=s.pharmacy.selectedDrugStore)||void 0===n?void 0:n.id)||(null===(o=s.pharmacy.widget)||void 0===o?void 0:o.businessId),origin:"pharmacy"})[E.a]=b.f(i.query),c);g.a.fetch(u,s.config).then(function(e){var r=e.items[0];r&&f.F(r)&&a(O.openCheckout(r))}).catch(function(){a(O.updatePharmacyDialog("something_went_wrong"))})}}},addToCart:function(a){return function(e,r,t){var n,o=t.config,c=r();return p.a.reachGoal("add_to_cart"),(null===(n=o.pharmacy)||void 0===n?void 0:n.bunker.isGtagEnabled)&&j.a.addToCartReportConversion(o),e({type:"DEEP_EXTEND",payload:{pharmacy:{cart:b.b(a,c.pharmacy.isCartDetached,c.pharmacy.cart)}}})}},clearCart:function(){return function(a,e){return a({type:"DEEP_EXTEND",payload:{pharmacy:{cart:b.c({isDryRun:e().pharmacy.isCartDetached})}}})}},resetProduct:function(){return{type:"DEEP_EXTEND",payload:{pharmacy:{productPage:void 0,map:void 0}}}},resetPharmacies:function(){return function(a,e,r){r.config;var t,n=null===(t=e().pharmacy.productPage)||void 0===t?void 0:t.pharmacies;(null==n?void 0:n.booking)||null==n||n.delivery}},addDebugBounds:function(a){return function(e,r){var t=r();e({type:"DEEP_EXTEND",payload:{pharmacy:{debugBounds:[].concat(t.pharmacy.debugBounds,[a])}}})}},fetchShowcase:function(){return function(a,e,r){var t=r.config,n=w.a.fetchShowcase(t);P.a.cancel(o),a({type:"DEEP_EXTEND",payload:{pharmacy:{showcase:{isLoading:!0}}}}),o=P.a.create(n,{success:function(e){a({type:"DEEP_EXTEND",payload:{pharmacy:{pageType:"showcase",showcase:{sections:e}}}})},fail:function(a){Object(v.b)(a,{config:t,prefix:"[Fetch showcase]"})},always:function(){a({type:"DEEP_EXTEND",payload:{pharmacy:{showcase:{isLoading:!1}}}})}})}},fetchPharmacies:function(a,e){return void 0===e&&(e=!1),function(r,t){var n,o,i,s,d,p=t(),h=p.config,m=p.pharmacy;if(null===(n=m.productPage)||void 0===n?void 0:null===(o=n.minimap)||void 0===o?void 0:o.size){var y=m.productPage.minimap,_=l.h(y.size,y.margin),D=a.map(f.d);P.a.cancel(c),r({type:"DEEP_EXTEND",payload:{pharmacy:{productPage:{pharmacies:{isLoading:!0}}}}});var b=y.location,w=b.center,C=b.zoom,j=l.a(w,C||11,_),T={clientId:"pharmacy",origin:"minimap",bbox:j,count:10,rearr:"scheme_Local/Geo/ResultsUnderSeparator/ResultsToAdd=0",relev_ranking_formula:"common__drugCartSort",snippets:["matchedobjects/1.x"]};(null===(i=h.pharmacy)||void 0===i?void 0:i.experiments.ui.newRanking)||delete T.relev_ranking_formula;var I=Object(u.a)(Object(u.a)({},T),{},((s={})[E.a]="1:"+a.join(),s)),N=Object(u.a)(Object(u.a)({},T),{},((d={})[E.a]="1:"+D.join(),d));c=P.a.create(Promise.all([g.a.fetch(I,h),g.a.fetch(N,h)]),{success:function(t){var n,o=t[0],c=t[1];if(e&&0===o.items.length&&0===c.items.length){var i=h.userRegion.center;return r({type:"DEEP_EXTEND",payload:{pharmacy:{productPage:{minimap:{location:{zoom:E.e,center:i}}}}}}),void r(O.fetchPharmacies(a))}var s=o.bounds&&c.bounds?l.b(o.bounds,c.bounds):null!==(n=o.bounds)&&void 0!==n?n:c.bounds;if(s){var u;s=l.b(s,j),!(null===(u=h.pharmacy)||void 0===u?void 0:u.isRegionChosenByUser)&&p.geolocation.currentPosition&&(s=l.b(s,[p.geolocation.currentPosition,p.geolocation.currentPosition]));var d=l.g(s,_,!1),m=l.c(s),y=l.f(s);r({type:"DEEP_EXTEND",payload:{pharmacy:{productPage:{minimap:{location:{zoom:d,center:m,span:y}}}}}})}r({type:"DEEP_EXTEND",payload:{pharmacy:{productPage:{pharmacies:{delivery:c.items,booking:o.items}}}}})},fail:function(a){var e,r,t,n;Object(v.b)(a,{config:h,prefix:"[FETCH_PHARMACIES]",additional:{yandexParams:I,zdravcityParams:N,pharmacy:{name:null===(e=p.pharmacy.productPage)||void 0===e?void 0:e.product.name,isAvailable:null===(r=p.pharmacy.productPage)||void 0===r?void 0:r.product.isAvailable,variants:null===(t=p.pharmacy.productPage)||void 0===t?void 0:t.product.variants.map(function(a){return{isAvailable:a.isAvailable,ids:a.drugIds}})},geoId:null===(n=h.pharmacy)||void 0===n?void 0:n.geoId,errorCode:null==a?void 0:a.code}})},always:function(){r({type:"DEEP_EXTEND",payload:{pharmacy:{productPage:{pharmacies:{isLoading:!1}}}}})}})}}},openMap:function(a,e){return void 0===a&&(a={}),function(r,t,n){var o,c,i=n.config,s=t(),p=Object(d.b)(s,{format:"query"}).params,h=p.pron,m=p.loggers,y=p.debug,f=T.a(s);f[3]+=50;var g=l.h({width:window.innerWidth,height:window.innerHeight},f),v=l.a(s.map.location.center,s.map.location.zoom||11,g),_=l.f(v),P=Object(u.a)(((o={})[E.c]=a[E.j]?void 0:b.d(b.g(i.query)),o.mode="search",o.pron=h,o.loggers=m,o.debug=y,o.sll=s.map.location.center.join(),o.sspn=_.join(),o),a),w=D.i("/",i,P),C=function(){return window.open(w,"_self")};(null==e?void 0:e.isGtagReport)&&(null===(c=i.pharmacy)||void 0===c?void 0:c.bunker.isGtagEnabled)?(j.a.choosePharmacyReportConversion(i,C),window.setTimeout(C,2e3)):C()}},checkout:function(a){return function(e,r,t){var n,o,c=t.config,i=null===(n=r().pharmacy.map)||void 0===n?void 0:n.cart;if(i){var s=((o={})[E.c]=b.d(i),o[E.s]=Object(m.f)(a),o[E.n]=a.id,o),u=D.c(s,"/cart/checkout",c);window.open(u,"_self")}}},setMinimap:function(a){return function(e){e({type:"DEEP_EXTEND",payload:{pharmacy:{productPage:{minimap:a}}}})}},updateGeolocation:function(a,e){return function(r,t,n){var o=n.config,c=t();if(a&&e){var s=w.a.getGeolocation(a,o);P.a.cancel(i),i=P.a.create(s,{success:function(t){var n;"confirm"!==(null===(n=c.pharmacy.geolocation)||void 0===n?void 0:n.status)||"confirm"!==t.status?("ignore"!==t.status&&(r(O.updateMapLocation(a)),r(O.updateUserGeolocation(a,e))),r({type:"DEEP_EXTEND",payload:{pharmacy:{geolocation:t}}})):r(O.updateUserGeolocation(a,e))},fail:function(a){Object(v.b)(a,{config:o,prefix:"[Get geolocation]"}),r(O.updateGeolocationStatus("ignore"))}})}else r(O.updateGeolocationStatus("ignore"))}},updateGeolocationStatus:function(a){return function(e,r,t){var n=t.config;"suggest-auto"!==a&&"ignore"!==a||(e(O.updateMapLocation(n.mapLocation.center)),e({type:"DEEP_EXTEND",payload:{geolocation:{currentPosition:null}}})),e({type:"DEEP_EXTEND",payload:{pharmacy:{geolocation:{status:a}}}})}},updateMapLocation:function(a){return function(e,r){var t,n=r(),o=T.a(n),c={width:window.innerWidth,height:window.innerHeight},i=l.d({center:a,zoom:11},o,c),s=Object(u.a)(Object(u.a)({},i),{},{bounds:void 0});(null===(t=n.pharmacy.productPage)||void 0===t?void 0:t.minimap)&&e(O.setMinimap({location:Object(u.a)(Object(u.a)({},n.pharmacy.productPage.minimap.location),{},{zoom:11,center:a}),locationRequest:s})),e({type:"DEEP_EXTEND",payload:{map:{location:s}}})}},updateUserGeolocation:function(a,e){return{type:"DEEP_EXTEND",payload:{geolocation:{currentPosition:a,lastTimeUpdate:(new Date).getTime(),accuracy:e}}}},updateSelectedProductManufacturer:function(a){return function(e,r,t){var n=t.config,o=r().pharmacy.productPage||{},c=o.product,i=o.selectedVariantId;if(c&&void 0!==i){var s=y.f(c,a,i);s.drugIds[0]&&_.a("replace",null,f.e(s.drugIds[0],n)),e({type:"DEEP_EXTEND",payload:{pharmacy:{productPage:{selectedManufacturerName:a,selectedVariantId:s.id}}}});var u={sets:[{ids:s.drugIds.map(f.c)||[],count:1}]};e(h.a.reloadMap(u))}}},updateSelectedProductVariant:function(a){return function(e,r,t){var n=t.config,o=r().pharmacy.productPage||{},c=o.product,i=o.selectedManufacturerName;if(c&&i){var s=y.f(c,i,a);s.drugIds[0]&&_.a("replace",null,f.e(s.drugIds[0],n)),e({type:"DEEP_EXTEND",payload:{pharmacy:{productPage:{selectedVariantId:s.id}}}});var u={sets:[{ids:s.drugIds.map(f.c)||[],count:1}]};e(h.a.reloadMap(u))}}},fetchSupplierInfo:function(a){return function(e,r,t){var n=t.config,o=r().pharmacy.cartCheckoutPage;if(o){var c=o.selectedDrugStore,i=o.cartCheckoutItems,u={pharmacyPermalink:Number(c.id),drugs:i.filter(function(a){return a.searchInfo.available}).map(function(a){return{id:a.searchInfo.id,quantity:a.quantity}}).filter(function(a){return Boolean(a)})};P.a.cancel(s);var d=w.a.getInfo(u,n);s=P.a.create(d,{success:function(a){if(a&&"drugsInfo"in a&&a.drugsInfo){var r=a.drugsInfo,t=b.v(i,function(a){return r[f.f(a.searchInfo.id||"")]}),n=b.l(t);e({type:"DEEP_EXTEND",payload:{pharmacy:{cartCheckoutPage:{changedItems:n}}}})}},fail:function(a){var e=a||new Error("Request for drugs_info/ failed");Object(v.b)(e,{config:n,prefix:"[Fetch Supplier Info]"})},always:a})}}}};e.default=O}}]);